<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Open E→C Dictionary Browser</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              canvas: {
                DEFAULT: '#0f172a',
                lighter: '#1e293b',
              },
            },
            boxShadow: {
              soft: '0 24px 48px -24px rgba(15, 23, 42, 0.45)',
            },
          },
        },
      };
    </script>
  </head>
  <body class="min-h-screen bg-canvas text-slate-100">
    <div class="mx-auto flex min-h-screen max-w-5xl flex-col gap-8 px-4 py-12">
      <header
        class="flex flex-col gap-4 text-center sm:flex-row sm:items-start sm:justify-between sm:text-left"
      >
        <div class="space-y-3">
          <h1 class="text-3xl font-semibold tracking-tight sm:text-4xl">
            Open English → Chinese Dictionary
          </h1>
          <p class="text-base text-slate-400 sm:text-lg">
            输入任意英文单词，页面会直接请求
            <code
              class="rounded bg-slate-800 px-1 py-0.5 text-sm text-slate-200"
              >dictionary/&lt;word&gt;.json</code
            >
            并在下方展示详细释义。
          </p>
        </div>
        <a
          href="https://github.com/ahpxex/open-english-dictionary"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 self-center rounded-xl border border-slate-700 bg-slate-900/80 px-4 py-2 text-sm font-medium text-slate-200 transition hover:border-slate-400 hover:bg-slate-800 focus-visible:border-slate-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-500/40 sm:self-start"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
            class="h-5 w-5"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M12 2C6.477 2 2 6.484 2 12.017c0 4.423 2.865 8.18 6.839 9.504.5.092.682-.217.682-.482 0-.237-.009-.868-.014-1.703-2.782.605-3.369-1.34-3.369-1.34-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.833.091-.647.35-1.088.636-1.339-2.22-.253-4.555-1.112-4.555-4.946 0-1.092.39-1.987 1.029-2.687-.103-.253-.447-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0 1 12 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.748-1.026 2.748-1.026.547 1.378.203 2.397.1 2.65.64.7 1.028 1.595 1.028 2.687 0 3.842-2.339 4.69-4.566 4.939.359.31.678.921.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .267.18.58.688.482A10.019 10.019 0 0 0 22 12.017C22 6.484 17.523 2 12 2Z"
              clip-rule="evenodd"
            />
          </svg>
          GitHub
        </a>
      </header>

      <main class="flex flex-col gap-6">
        <section
          class="rounded-2xl border border-slate-800 bg-canvas-lighter/80 p-6 shadow-soft backdrop-blur"
        >
          <form id="searchForm" class="space-y-4">
            <div class="space-y-2">
              <label
                for="searchInput"
                class="block text-sm font-medium uppercase tracking-wider text-slate-400"
                >搜索单词</label
              >
              <input
                id="searchInput"
                type="search"
                name="word"
                placeholder="例如：ability"
                autocomplete="off"
                class="w-full rounded-xl border border-slate-700 bg-slate-900/70 px-4 py-3 text-lg text-slate-100 outline-none transition focus:border-slate-400 focus:ring-2 focus:ring-slate-500/50"
              />
              <p class="text-sm text-slate-500">
                按下回车即可获取
                <code>dictionary/&lt;word&gt;.json</code> 的内容。
              </p>
            </div>
          </form>
          <div
            id="statusMessage"
            class="mt-4 text-sm text-slate-400"
            role="status"
            aria-live="polite"
          ></div>
          <div
            id="history"
            class="mt-5 grid gap-2 sm:grid-cols-2 lg:grid-cols-3"
            aria-live="polite"
          ></div>
        </section>

        <section
          class="rounded-2xl border border-slate-800 bg-canvas-lighter/60 p-6 shadow-soft backdrop-blur"
        >
          <h2 class="text-lg font-semibold text-slate-200">词条详情</h2>
          <div id="entryView" class="prose prose-invert mt-4 max-w-none"></div>
        </section>
      </main>
    </div>

    <template id="entryTemplate">
      <article class="space-y-8">
        <header class="space-y-2">
          <div class="flex flex-wrap items-baseline gap-3">
            <h3
              data-field="word"
              class="text-3xl font-semibold tracking-tight text-white"
            ></h3>
            <span
              data-field="pronunciation"
              class="rounded-lg border border-slate-600/60 bg-slate-800/80 px-3 py-1 text-sm uppercase tracking-wide text-slate-200"
            ></span>
          </div>
          <p
            data-field="concise_definition"
            class="text-base text-slate-300"
          ></p>
        </header>

        <section class="space-y-3">
          <h4 class="text-sm font-semibold uppercase tracking-wider text-slate-400">
            词形变化
          </h4>
          <dl
            data-field="forms"
            class="grid gap-3 rounded-xl border border-slate-700/70 bg-slate-900/60 p-4 sm:grid-cols-2"
          ></dl>
        </section>

        <section class="space-y-3">
          <h4 class="text-sm font-semibold uppercase tracking-wider text-slate-400">
            详细释义
          </h4>
          <div
            data-field="definitions"
            class="space-y-4"
          ></div>
        </section>

        <section class="space-y-3">
          <h4 class="text-sm font-semibold uppercase tracking-wider text-slate-400">
            近义词比较
          </h4>
          <div
            data-field="comparison"
            class="space-y-3"
          ></div>
        </section>
      </article>
    </template>

    <script>
      (() => {
        const MAX_HISTORY = 18;
        const state = {
          history: [],
        };

        const searchInput = document.getElementById('searchInput');
        const statusMessage = document.getElementById('statusMessage');
        const historyContainer = document.getElementById('history');
        const entryView = document.getElementById('entryView');
        const form = document.getElementById('searchForm');
        const entryTemplate = document.getElementById('entryTemplate');

        function setStatus(message, tone = 'muted') {
          statusMessage.textContent = message ?? '';
          statusMessage.className =
            'mt-4 text-sm ' +
            (tone === 'error'
              ? 'text-rose-400'
              : tone === 'info'
              ? 'text-slate-300'
              : 'text-slate-500');
        }

        function escapeHtml(value) {
          return value
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;');
        }

        function renderHistory() {
          if (!state.history.length) {
            historyContainer.innerHTML =
              '<p class="col-span-full rounded-xl border border-dashed border-slate-700/60 bg-slate-900/40 px-4 py-6 text-center text-sm text-slate-500">暂无历史记录。</p>';
            return;
          }

          historyContainer.innerHTML = state.history
            .map(
              (word) => `
                <button
                  type="button"
                  data-word="${word}"
                  class="rounded-xl border border-slate-700/60 bg-slate-900/60 px-4 py-3 text-left text-base text-slate-200 transition hover:border-slate-400 hover:bg-slate-800/70 focus-visible:border-slate-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-500/40"
                >
                  ${escapeHtml(word)}
                </button>
              `
            )
            .join('');
        }

        async function loadEntry(word) {
          if (!word) {
            setStatus('请输入需要查询的单词。', 'info');
            return;
          }

          const normalized = word.trim().toLowerCase();
          setStatus(`正在加载「${normalized}」的词条…`, 'info');

          try {
            const response = await fetch(
              `dictionary/${encodeURIComponent(normalized)}.json`
            );
            if (!response.ok) {
              throw new Error('词条不存在或无法访问。');
            }

            const data = await response.json();
            renderEntry(data);
            setStatus(`已载入词条：${normalized}`);
            addToHistory(normalized);
          } catch (error) {
            console.error(error);
            entryView.innerHTML =
              '<p class="rounded-xl border border-rose-500/40 bg-rose-500/10 px-4 py-6 text-sm text-rose-200">未能加载该词条，请确认对应 JSON 文件是否存在。</p>';
            setStatus(error.message ?? '加载失败。', 'error');
          }
        }

        function renderEntry(entry) {
          const fragment = entryTemplate.content.cloneNode(true);

          fragment.querySelector('[data-field="word"]').textContent =
            entry.word ?? '—';
          fragment.querySelector('[data-field="pronunciation"]').textContent =
            entry.pronunciation ?? '—';
          fragment.querySelector(
            '[data-field="concise_definition"]'
          ).textContent = entry.concise_definition ?? '—';

          const formsContainer = fragment.querySelector('[data-field="forms"]');
          formsContainer.innerHTML = '';
          if (entry.forms && typeof entry.forms === 'object') {
            Object.entries(entry.forms).forEach(([key, value]) => {
              const item = document.createElement('div');
              item.className =
                'flex items-baseline justify-between gap-3 rounded-lg border border-slate-700/70 bg-slate-900/60 px-3 py-2';
              item.innerHTML = `
                <dt class="text-xs uppercase tracking-wide text-slate-400">${escapeHtml(
                  key
                )}</dt>
                <dd class="text-sm text-slate-200">${escapeHtml(
                  String(value)
                )}</dd>
              `;
              formsContainer.appendChild(item);
            });
          } else {
            formsContainer.innerHTML =
              '<p class="col-span-full text-sm text-slate-500">无词形变化信息。</p>';
          }

          const definitionsContainer = fragment.querySelector(
            '[data-field="definitions"]'
          );
          definitionsContainer.innerHTML = '';
          if (Array.isArray(entry.definitions) && entry.definitions.length) {
            entry.definitions.forEach((definition, index) => {
              const block = document.createElement('div');
              block.className =
                'rounded-xl border border-slate-700/60 bg-slate-900/60 p-4 space-y-3';
              block.innerHTML = `
                <header class="flex flex-wrap items-center gap-2">
                  <span class="rounded-md bg-slate-800/80 px-2 py-1 text-xs uppercase tracking-wide text-slate-300">释义 ${
                    index + 1
                  }</span>
                  <span class="text-xs text-slate-400">${escapeHtml(
                    definition.pos ?? ''
                  )}</span>
                </header>
                <p class="text-sm leading-relaxed text-slate-200">${escapeHtml(
                  definition.explanation_cn ?? ''
                )}</p>
                <p class="text-sm leading-relaxed text-slate-400">${escapeHtml(
                  definition.explanation_en ?? ''
                )}</p>
                <div class="rounded-lg border border-slate-700/50 bg-slate-900/50 p-3 text-sm text-slate-300">
                  <p class="text-slate-200">例句（EN）：${escapeHtml(
                    definition.example_en ?? ''
                  )}</p>
                  <p class="mt-1 text-slate-400">例句（CN）：${escapeHtml(
                    definition.example_cn ?? ''
                  )}</p>
                </div>
              `;
              definitionsContainer.appendChild(block);
            });
          } else {
            definitionsContainer.innerHTML =
              '<p class="text-sm text-slate-500">暂无详细释义。</p>';
          }

          const comparisonContainer = fragment.querySelector(
            '[data-field="comparison"]'
          );
          comparisonContainer.innerHTML = '';
          if (Array.isArray(entry.comparison) && entry.comparison.length) {
            entry.comparison.forEach((item) => {
              const block = document.createElement('div');
              block.className =
                'rounded-xl border border-slate-700/60 bg-slate-900/60 p-4';
              block.innerHTML = `
                <h5 class="text-sm font-medium text-slate-200">${escapeHtml(
                  item.word_to_compare ?? ''
                )}</h5>
                <p class="mt-2 text-sm leading-relaxed text-slate-300">${escapeHtml(
                  item.analysis ?? ''
                )}</p>
              `;
              comparisonContainer.appendChild(block);
            });
          } else {
            comparisonContainer.innerHTML =
              '<p class="text-sm text-slate-500">暂无近义词比较。</p>';
          }

          entryView.innerHTML = '';
          entryView.appendChild(fragment);
        }

        function addToHistory(word) {
          state.history = [word, ...state.history.filter((w) => w !== word)].slice(0, MAX_HISTORY);
          renderHistory();
        }

        // Event bindings
        form.addEventListener('submit', (event) => {
          event.preventDefault();
          loadEntry(searchInput.value);
        });

        historyContainer.addEventListener('click', (event) => {
          const button = event.target.closest('button[data-word]');
          if (!button) return;
          const word = button.getAttribute('data-word');
          searchInput.value = word;
          loadEntry(word);
        });

        // Initialize
        setStatus('请输入要查询的单词并按回车加载词条。');
        renderHistory();
      })();
    </script>
  </body>
</html>
